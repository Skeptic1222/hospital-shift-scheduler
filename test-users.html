<!DOCTYPE html>
<html>
<head>
    <title>User Management Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 5px; padding: 10px; cursor: pointer; }
        .user { border: 1px solid #ccc; padding: 10px; margin: 5px; }
        .delete-btn { background: #f44336; color: white; }
        #addForm { border: 1px solid #4CAF50; padding: 10px; margin: 10px 0; }
        input { margin: 5px; padding: 5px; }
    </style>
</head>
<body>
    <h1>User Management Test (Direct API)</h1>
    
    <div id="addForm">
        <h3>Add New User</h3>
        <input id="firstName" placeholder="First Name" value="Test">
        <input id="lastName" placeholder="Last Name" value="User">
        <input id="email" placeholder="Email" value="test@demo.hospital.com">
        <select id="role">
            <option value="user">User</option>
            <option value="supervisor">Supervisor</option>
            <option value="admin">Admin</option>
        </select>
        <input id="department" placeholder="Department" value="ED">
        <button onclick="addUser()">Add User</button>
    </div>
    
    <button onclick="loadUsers()">Refresh Users</button>
    <h2>Current Users:</h2>
    <div id="userList"></div>
    
    <script>
        const API_BASE = 'http://192.168.1.2/scheduler/api';
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFkbWluQGRlbW8uaG9zcGl0YWwuY29tIiwibmFtZSI6IkFkbWluIiwicm9sZXMiOlsiYWRtaW4iXX0.test';
        
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                const userList = document.getElementById('userList');
                userList.innerHTML = '';
                
                if (data.users && data.users.length > 0) {
                    data.users.forEach(user => {
                        const userDiv = document.createElement('div');
                        userDiv.className = 'user';
                        userDiv.innerHTML = `
                            <strong>${user.name || user.first_name + ' ' + user.last_name}</strong> 
                            (${user.email}) - ${user.role} - ${user.department_id || 'No Dept'}
                            <button class="delete-btn" onclick="deleteUser('${user.id}')">Delete</button>
                        `;
                        userList.appendChild(userDiv);
                    });
                } else {
                    userList.innerHTML = '<p>No users found</p>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('userList').innerHTML = '<p>Error loading users</p>';
            }
        }
        
        async function addUser() {
            const newUser = {
                first_name: document.getElementById('firstName').value,
                last_name: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                role: document.getElementById('role').value,
                department_id: document.getElementById('department').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newUser)
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('User added successfully!');
                    loadUsers();
                    // Clear form
                    document.getElementById('email').value = '';
                } else {
                    alert('Error: ' + (data.error || 'Failed to add user'));
                }
            } catch (error) {
                console.error('Error adding user:', error);
                alert('Error adding user');
            }
        }
        
        async function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('User deleted successfully!');
                    loadUsers();
                } else {
                    alert('Error: ' + (data.error || 'Failed to delete user'));
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('Error deleting user');
            }
        }
        
        // Load users on page load
        loadUsers();
    </script>
</body>
</html>